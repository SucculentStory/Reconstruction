% Tutorial 6: Visualizations
% R Bootcamp HTML Slides
% Jared Knowles

```{r setuph, include=FALSE}
# set global chunk options
opts_chunk$set(fig.path='figure/slides6-', cache.path='cache/slides6-',fig.width=8,fig.height=6,message=FALSE,error=FALSE,warning=FALSE,echo=TRUE,size='tiny',dev='svg')
source('ggplot2themes.R')
```

# Overview
In this lesson we hope to learn:
- How to draw diagnostic plots in base graphics
- Colors
- `ggplot2' 
- Basic geoms
- Layering and faceting plots
- Putting it together

```{r setup, message=FALSE,warning=FALSE,echo=FALSE,comment=FALSE}
load('data/smalldata.rda')
dropbox_source<-function(myurl){
  require(stringr)
  s<-str_extract(myurl,"[/][a-z][/]\\d+[/][a-z]*.*")
  new_url<-paste("http://dl.dropbox.com",s,sep="")
  source(new_url)
}
```

# Graphics Matter
- Graphics are a huge part of R and R encourages its users to use visualization to aid and present analysis
- Graphics are hard to get right, but tools can help make it easier
- Lots of great resources to help available for this online

# Basic Plot
- Don't use R base graphics
- `ggplot2` is pretty much the new standard in R
- Create beautiful, clear plots with a nice consistent set of language conventions

```{r plot1}
library(ggplot2)
qplot(readSS,mathSS,data=df)
```
- Consider this basic scatterplot

# Variations
```{r plot2,message=FALSE,warning=FALSE}
qplot(readSS,mathSS,data=df)+geom_smooth()
qplot(readSS,mathSS,data=df,alpha=I(0.3))
qplot(readSS,mathSS,data=df)+xlab('Reading Score')+ylab('Math Score')
qplot(readSS,mathSS,data=df,color=race)+scale_color_brewer(type='qual',palette=2)
```

# Visualization Philosophy
- Visualization is about thinking about what objects in our dataset map with what visual cues for the viewer
  - liberal use of `names(object)` helps
- What is the best way to show discrete variables, continuous variables, and connected variables

# Our data
- As we now know, student data is quite fascinating
- We have many discrete attribute variables
  - Race, gender, economics, etc.
- We have some continuous variables
  - Test scores, attendance
- We have some grouping variables
  - Schools, districts, students, teachers
- Rich ground to make a number of visualizations that are useful


# A few pro tips
- Don't be afraid to manipulate the data
  - Aggregate, combine, rescale variables to make the story easier to understand
- Don't use too much color
  - People print your work, color blindness is more prevalent than you think
  - Color is fickle. Monitors and projectors reproduce it differently.
- Don't overwhelm the user
  - Make your visual depictions as easy as possible to immediately understand that data
- Don't plot everything all at once


# Draw a Colorwheel to show this problem
```{r colorwheel}
colwheel<-"https://dl.dropbox.com/u/1811289/colorwheel.R"
dropbox_source(colwheel)
col.wheel("magenta",nearby=2)
col.wheel("orange",nearby=2)
col.wheel("brown",nearby=2)
```

# Start with a great example
```{r premier}
library(grid)
p1<-qplot(readSS,..density..,data=df,fill=race,
      position='fill',geom='density')+scale_fill_brewer(
        type='qual',palette=2)

p2<-qplot(readSS,..fill..,data=df,fill=race,
      position='fill',geom='density')+scale_fill_brewer(
        type='qual',palette=2)+ylim(c(0,1))+theme_bw()+
          opts(legend.position='none',
               axis.text.x=theme_blank(),
               axis.text.y=theme_blank(),
               axis.ticks=theme_blank(),
               panel.margin=unit(0,"lines"))+ylab('')+
                 xlab('')

vp<-viewport(x=unit(.65,"npc"),y=unit(.73,"npc"),
             width=unit(.2,"npc"),height=unit(.2,"npc"))
print(p1)
print(p2,vp=vp)

```

# Now, how?
- `ggplot2` can be understood as combining a few concepts
  - aesthetics, geoms, layers, and scales
- Making high quality graphics is just a matter of applying the right data to the right aesthetics in an appropriate geom, adding layer for detail, and ensuring the scale is appropriate
- Let's talk about how to do that next

# Aesthetics
- aesthetics are the axes, colors, glyphs, and sizes of the data mapped to visual cues
- `ggplot2` has an extended syntax that makes this obvious
```{r extended}
ggplot(df,aes(x=readSS,y=mathSS))+geom_point()
```
- We've seen this guy before
- This makes `ggplot2` like a sublanguage under R
- `aes` says we are specifying aesthetics, here we specified x and y to make a two dimensional graphic

